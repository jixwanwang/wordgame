# Deployment Guide

Complete guide for deploying the Wordgame API to Google Cloud Platform.

---

## Table of Contents

- [Architecture Overview](#architecture-overview)
- [Prerequisites](#prerequisites)
- [Configuration](#configuration)
- [Deployment Scripts](#deployment-scripts)
- [Manual Deployment Steps](#manual-deployment-steps)
- [Database Management](#database-management)
- [Process Management (PM2)](#process-management-pm2)
- [Nginx Reverse Proxy](#nginx-reverse-proxy)
- [Troubleshooting](#troubleshooting)
- [Useful Commands Reference](#useful-commands-reference)

---

## Architecture Overview

### Components

```
┌─────────────────────────────────────────────────────────────┐
│ Local Machine                                               │
│ ├── Source Code                                             │
│ ├── Cloud SQL Proxy (for local DB access)                  │
│ └── Deployment Scripts                                      │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ gcloud scp (deploy.sh)
                            │ gcloud ssh (ssh.sh)
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ GCP Compute Engine VM (e2-micro)                            │
│ ├── Node.js Application (port 3000)                         │
│ ├── PM2 (process manager)                                   │
│ └── Nginx (reverse proxy, ports 80/443)                     │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ Unix socket connection
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ GCP Cloud SQL (PostgreSQL)                                  │
│ ├── Users table                                             │
│ └── Results table                                           │
└─────────────────────────────────────────────────────────────┘
```

### Tech Stack

- **Backend**: Node.js + Express + TypeScript
- **Database**: PostgreSQL (Cloud SQL)
- **ORM**: Drizzle ORM
- **Process Manager**: PM2
- **Reverse Proxy**: Nginx
- **Build Tool**: esbuild + vite

---

## Prerequisites

### Required Software

```bash
# Install gcloud CLI
# Visit: https://cloud.google.com/sdk/docs/install

# Verify installation
gcloud --version

# Authenticate
gcloud auth login

# Set project
gcloud config set project project-ce31194e-b92f-4b22-9e0
```

### GCP Resources

- **Project ID**: `project-ce31194e-b92f-4b22-9e0`
- **VM Instance**: `wordgame` (or your custom name)
- **VM Zone**: `us-west1-b`
- **VM IP**: `136.118.23.174`
- **Cloud SQL Instance**: `project-ce31194e-b92f-4b22-9e0:us-west1:wordgame`

### Required Firewall Rules

```bash
# Allow HTTP (port 80)
gcloud compute firewall-rules create allow-http \
  --allow=tcp:80 \
  --target-tags=http-server \
  --description="Allow HTTP traffic" \
  --project=project-ce31194e-b92f-4b22-9e0

# Allow HTTPS (port 443)
gcloud compute firewall-rules create allow-https \
  --allow=tcp:443 \
  --target-tags=http-server \
  --description="Allow HTTPS traffic" \
  --project=project-ce31194e-b92f-4b22-9e0

# Allow custom port (optional, for direct access to port 3000)
gcloud compute firewall-rules create allow-api \
  --allow=tcp:3000 \
  --target-tags=http-server \
  --description="Allow API traffic" \
  --project=project-ce31194e-b92f-4b22-9e0
```

---

## Configuration

### Local `.env` File

Create/update `.env` in your project root:

```bash
# GCP Configuration (for deployment scripts)
GCP_PROJECT_ID=project-ce31194e-b92f-4b22-9e0
GCP_VM_NAME=wordgame
GCP_ZONE=us-west1-b

# Database Configuration (for local development with Cloud SQL Proxy)
DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@127.0.0.1:5432/wordgame

# Application Configuration
NODE_ENV=development
PORT=3000

# JWT Secret
JWT_SECRET=your-secret-key-here

# Cloud SQL Connection Name
CLOUD_SQL_CONNECTION_NAME=project-ce31194e-b92f-4b22-9e0:us-west1:wordgame
```

### VM `.env` File

The `.env` file on the VM (created by `setup-vm.sh`) should use Unix socket connection:

```bash
# Database Configuration (Cloud SQL via Unix Socket)
DATABASE_URL=postgresql://wordgame_user:YOUR_PASSWORD@/wordgame?host=/cloudsql/project-ce31194e-b92f-4b22-9e0:us-west1:wordgame

# Application Configuration
NODE_ENV=production
PORT=3000

# JWT Secret (auto-generated by setup script)
JWT_SECRET=<auto-generated>

# Cloud SQL Connection Name
CLOUD_SQL_CONNECTION_NAME=project-ce31194e-b92f-4b22-9e0:us-west1:wordgame
```

---

## Deployment Scripts

### `scripts/deploy.sh`

**Purpose**: Copy source code from local machine to VM

**What it does**:
1. Reads GCP config from `.env`
2. Creates remote directory on VM
3. Copies directories: `server/`, `client/`, `lib/`, `scripts/`
4. Copies files: `package.json`, `tsconfig.json`, `drizzle.config.ts`, etc.

**Usage**:
```bash
./scripts/deploy.sh
```

**Underlying commands**:
```bash
# Create remote directory
gcloud compute ssh $VM_NAME \
  --project=$PROJECT_ID \
  --zone=$ZONE \
  --command="mkdir -p wordgame"

# Copy directory
gcloud compute scp --recurse \
  server \
  $VM_NAME:~/wordgame/ \
  --project=$PROJECT_ID \
  --zone=$ZONE

# Copy file
gcloud compute scp \
  package.json \
  $VM_NAME:~/wordgame/ \
  --project=$PROJECT_ID \
  --zone=$ZONE
```

---

### `scripts/ssh.sh`

**Purpose**: SSH into the VM

**What it does**:
1. Reads GCP config from `.env`
2. Opens SSH connection to VM

**Usage**:
```bash
./scripts/ssh.sh
```

**Underlying command**:
```bash
gcloud compute ssh wordgame \
  --project=project-ce31194e-b92f-4b22-9e0 \
  --zone=us-west1-b
```

---

### `scripts/setup-vm.sh`

**Purpose**: Initial VM setup and application installation (run ON THE VM)

**What it does**:
1. Installs Node.js 20 (if not present)
2. Installs PM2 globally (if not present)
3. Runs `npm install`
4. Runs `npm run build`
5. Stops any existing PM2 processes
6. Starts application with PM2
7. Saves PM2 configuration
8. Sets up PM2 to auto-start on boot

**Usage**:
```bash
# On the VM
cd wordgame
./scripts/setup-vm.sh
```

**Underlying commands**:
```bash
# Install Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# Install PM2
sudo npm install -g pm2

# Install dependencies
npm install

# Build application
npm run build

# Start with PM2
pm2 start npm --name wordgame-api -- start

# Save PM2 config
pm2 save

# Enable PM2 on boot
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u $USER --hp $HOME
```

---

### `scripts/setup-nginx.sh`

**Purpose**: Install and configure Nginx reverse proxy (run ON THE VM)

**What it does**:
1. Installs Nginx (if not present)
2. Creates reverse proxy configuration
3. Proxies port 80 → localhost:3000
4. Includes HTTPS config (commented, ready for SSL)
5. Enables site and restarts Nginx

**Usage**:
```bash
# On the VM
cd wordgame
./scripts/setup-nginx.sh
```

**Underlying commands**:
```bash
# Install Nginx
sudo apt-get update
sudo apt-get install -y nginx

# Create configuration
sudo nano /etc/nginx/sites-available/wordgame

# Enable site
sudo rm -f /etc/nginx/sites-enabled/default
sudo ln -s /etc/nginx/sites-available/wordgame /etc/nginx/sites-enabled/

# Test configuration
sudo nginx -t

# Restart Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

---

### `scripts/cleanup-port.sh`

**Purpose**: Clean up port 3000 if it's stuck (run ON THE VM)

**What it does**:
1. Checks what's using port 3000
2. Stops all PM2 processes
3. Kills any lingering node processes
4. Verifies port is free

**Usage**:
```bash
# On the VM
cd wordgame
./scripts/cleanup-port.sh
```

**Underlying commands**:
```bash
# Check port usage
sudo ss -tlnp | grep :3000

# Stop PM2
pm2 stop all
pm2 delete all

# Kill node processes
pkill -9 node

# Verify port is free
sudo ss -tlnp | grep :3000  # Should return nothing
```

---

### `scripts/cloud-sql-proxy.sh`

**Purpose**: Start Cloud SQL Proxy for local development (run ON LOCAL MACHINE)

**What it does**:
1. Downloads Cloud SQL Proxy if not installed
2. Starts proxy on localhost:5432
3. Connects to Cloud SQL instance

**Usage**:
```bash
# On local machine
./scripts/cloud-sql-proxy.sh
```

**Underlying command**:
```bash
cloud-sql-proxy --port=5432 project-ce31194e-b92f-4b22-9e0:us-west1:wordgame
```

---

## Manual Deployment Steps

### Complete Deployment from Scratch

#### 1. Deploy Code

```bash
# From local machine
./scripts/deploy.sh
```

#### 2. SSH to VM

```bash
./scripts/ssh.sh
```

#### 3. Initial Setup (First Time Only)

```bash
# On the VM
cd wordgame

# Run setup script
./scripts/setup-vm.sh

# Setup Nginx
./scripts/setup-nginx.sh
```

#### 4. Create `.env` File

```bash
# On the VM
cd wordgame
nano .env
```

Add:
```
DATABASE_URL=postgresql://wordgame_user:YOUR_PASSWORD@/wordgame?host=/cloudsql/project-ce31194e-b92f-4b22-9e0:us-west1:wordgame
NODE_ENV=production
PORT=3000
JWT_SECRET=$(openssl rand -base64 32)
```

#### 5. Verify Everything is Running

```bash
# Check PM2
pm2 status

# View logs
pm2 logs wordgame-api

# Check Nginx
sudo systemctl status nginx

# Test the API
curl http://localhost
curl http://136.118.23.174
```

---

### Update Deployment (After Changes)

```bash
# 1. From local machine - deploy new code
./scripts/deploy.sh

# 2. SSH to VM
./scripts/ssh.sh

# 3. On VM - rebuild and restart
cd wordgame
npm install  # If package.json changed
npm run build
pm2 restart wordgame-api

# 4. Check logs
pm2 logs wordgame-api
```

---

## Database Management

### Local Development (with Cloud SQL Proxy)

```bash
# Terminal 1: Start Cloud SQL Proxy
./scripts/cloud-sql-proxy.sh

# Terminal 2: Push schema changes
npm run db:push

# Terminal 3: Run dev server
npm run dev
```

### Direct Database Access

```bash
# Via gcloud (easiest)
gcloud sql connect wordgame \
  --user=wordgame_user \
  --project=project-ce31194e-b92f-4b22-9e0

# Via psql with Cloud SQL Proxy running
psql -h 127.0.0.1 -U postgres -d wordgame

# Via psql on the VM (no proxy needed)
# Note: This requires the Cloud SQL Proxy to be running on the VM
# Or configure Cloud SQL with public IP and authorized networks
```

### Database Schema Operations

```bash
# Push schema changes (creates/updates tables)
npm run db:push

# Generate migration files
npx drizzle-kit generate

# View current schema
psql -h 127.0.0.1 -U postgres -d wordgame -c "\dt"  # List tables
psql -h 127.0.0.1 -U postgres -d wordgame -c "\d users"  # Describe table
```

### Inspect Database

```bash
# With Cloud SQL Proxy running locally
PGPASSWORD=YOUR_PASSWORD psql -h 127.0.0.1 -U postgres -d wordgame

# Common queries
\dt                          # List all tables
\d users                     # Describe users table
\d results                   # Describe results table
SELECT * FROM users;         # View all users
SELECT * FROM results;       # View all results
```

---

## Process Management (PM2)

### PM2 Basics

```bash
# Start application
pm2 start npm --name wordgame-api -- start

# View status
pm2 status

# View logs (live)
pm2 logs wordgame-api

# View logs (last 100 lines)
pm2 logs wordgame-api --lines 100

# View logs (all)
pm2 logs wordgame-api --lines all

# Restart application
pm2 restart wordgame-api

# Stop application
pm2 stop wordgame-api

# Delete application from PM2
pm2 delete wordgame-api

# Stop all processes
pm2 stop all

# Delete all processes
pm2 delete all

# Flush logs
pm2 flush

# Save current configuration
pm2 save

# Resurrect saved processes
pm2 resurrect
```

### PM2 Log Files

```bash
# Find log locations
pm2 show wordgame-api | grep "log path"

# View error log
cat ~/.pm2/logs/wordgame-api-error.log

# View output log
cat ~/.pm2/logs/wordgame-api-out.log

# Tail error log
tail -f ~/.pm2/logs/wordgame-api-error.log

# Tail output log
tail -f ~/.pm2/logs/wordgame-api-out.log
```

### PM2 Monitoring

```bash
# Real-time monitoring dashboard
pm2 monit

# Process details
pm2 show wordgame-api

# List processes with details
pm2 list
```

### Auto-Start on Reboot

```bash
# Generate startup script
pm2 startup

# Run the command it outputs, e.g.:
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u $USER --hp $HOME

# Save current process list
pm2 save

# Test by rebooting
sudo reboot

# After reboot, check if PM2 auto-started
pm2 status
```

---

## Nginx Reverse Proxy

### Nginx Configuration

Configuration file: `/etc/nginx/sites-available/wordgame`

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name _;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### Nginx Commands

```bash
# Test configuration
sudo nginx -t

# Reload configuration (without downtime)
sudo systemctl reload nginx

# Restart Nginx
sudo systemctl restart nginx

# Stop Nginx
sudo systemctl stop nginx

# Start Nginx
sudo systemctl start nginx

# Check status
sudo systemctl status nginx

# Enable auto-start on boot
sudo systemctl enable nginx

# View logs
sudo tail -f /var/log/nginx/wordgame-access.log
sudo tail -f /var/log/nginx/wordgame-error.log

# View all Nginx logs
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### HTTPS Setup (Optional)

```bash
# Install certbot
sudo apt-get update
sudo apt-get install -y certbot python3-certbot-nginx

# Get SSL certificate (replace with your domain)
sudo certbot --nginx -d yourdomain.com

# Certbot will:
# 1. Obtain SSL certificate from Let's Encrypt
# 2. Automatically update Nginx configuration
# 3. Enable HTTPS
# 4. Set up auto-renewal

# Test auto-renewal
sudo certbot renew --dry-run

# View certificates
sudo certbot certificates

# Manually renew
sudo certbot renew
```

---

## Troubleshooting

### Application Won't Start

**Symptom**: PM2 shows app as "errored" or constantly restarting

**Diagnosis**:
```bash
# View PM2 logs
pm2 logs wordgame-api --lines 100

# Try running directly (bypass PM2)
cd ~/wordgame
node dist/start.js

# Check if built files exist
ls -lh ~/wordgame/dist/

# Verify .env file exists
cat ~/wordgame/.env
```

**Common Causes**:
1. **Build failed**: Run `npm run build` and check for errors
2. **Missing dependencies**: Run `npm install`
3. **Port already in use**: Run `./scripts/cleanup-port.sh`
4. **Missing .env**: Create `.env` file with required variables

---

### Port Already in Use

**Symptom**: `Error: listen EADDRINUSE: address already in use :::3000`

**Solution**:
```bash
# Automated cleanup
./scripts/cleanup-port.sh

# Manual cleanup
pm2 delete all
pkill -9 node
sudo ss -tlnp | grep :3000  # Verify port is free

# Restart
pm2 start npm --name wordgame-api -- start
```

---

### Database Connection Issues

**Symptom**: Can't connect to database, authentication errors

**Diagnosis**:
```bash
# Check if DATABASE_URL is set
echo $DATABASE_URL

# On VM, test connection to Cloud SQL
# Note: VM connects via Unix socket, not TCP

# Verify Cloud SQL instance is running
gcloud sql instances describe wordgame \
  --project=project-ce31194e-b92f-4b22-9e0

# Check database exists
gcloud sql databases list \
  --instance=wordgame \
  --project=project-ce31194e-b92f-4b22-9e0

# Check user exists
gcloud sql users list \
  --instance=wordgame \
  --project=project-ce31194e-b92f-4b22-9e0
```

**Common Causes**:
1. **Wrong password**: Update `.env` with correct password
2. **Database doesn't exist**: Create database via Cloud Console
3. **User doesn't exist**: Create user via Cloud Console
4. **Wrong connection string**: VM should use Unix socket path

---

### Nginx Issues

**Symptom**: Can't access site via HTTP, Nginx errors

**Diagnosis**:
```bash
# Check Nginx status
sudo systemctl status nginx

# Test configuration
sudo nginx -t

# View error logs
sudo tail -50 /var/log/nginx/error.log

# Check if Nginx is listening on port 80
sudo ss -tlnp | grep :80

# Check firewall rules
gcloud compute firewall-rules list \
  --project=project-ce31194e-b92f-4b22-9e0 \
  --filter="allowed.ports:80"
```

**Common Causes**:
1. **Configuration syntax error**: Run `sudo nginx -t` to find errors
2. **Port 80 not allowed**: Add firewall rule for port 80
3. **Nginx not running**: Run `sudo systemctl start nginx`
4. **App not running**: Check `pm2 status` - Nginx proxies to port 3000

---

### Can't SSH to VM

**Symptom**: SSH connection refused or times out

**Diagnosis**:
```bash
# Check VM is running
gcloud compute instances list \
  --project=project-ce31194e-b92f-4b22-9e0

# Check VM details
gcloud compute instances describe wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# View serial port output (for boot issues)
gcloud compute instances get-serial-port-output wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0
```

**Solutions**:
```bash
# Start VM if stopped
gcloud compute instances start wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# Reset instance
gcloud compute instances reset wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0
```

---

### Application Running but Not Responding

**Symptom**: PM2 shows app as "online" but API doesn't respond

**Diagnosis**:
```bash
# Check if app is actually listening
sudo ss -tlnp | grep :3000

# Test from VM itself
curl http://localhost:3000/health

# Check PM2 logs for errors
pm2 logs wordgame-api --lines 50

# Check if Nginx is proxying correctly
curl -v http://localhost  # Via Nginx
curl -v http://localhost:3000  # Direct to app
```

**Common Causes**:
1. **App crashed but PM2 hasn't restarted yet**: Check `pm2 logs`
2. **App not binding to port**: Check startup logs
3. **Nginx misconfigured**: Test with direct connection to port 3000

---

## Useful Commands Reference

### GCP Commands

```bash
# List all VMs
gcloud compute instances list --project=project-ce31194e-b92f-4b22-9e0

# Get VM external IP
gcloud compute instances describe wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0 \
  --format='get(networkInterfaces[0].accessConfigs[0].natIP)'

# Start VM
gcloud compute instances start wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# Stop VM
gcloud compute instances stop wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# SSH to VM
gcloud compute ssh wordgame \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# Copy file to VM
gcloud compute scp local-file.txt wordgame:~/remote-file.txt \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# Copy file from VM
gcloud compute scp wordgame:~/remote-file.txt ./local-file.txt \
  --zone=us-west1-b \
  --project=project-ce31194e-b92f-4b22-9e0

# List Cloud SQL instances
gcloud sql instances list --project=project-ce31194e-b92f-4b22-9e0

# Connect to Cloud SQL
gcloud sql connect wordgame \
  --user=wordgame_user \
  --project=project-ce31194e-b92f-4b22-9e0
```

### VM System Commands

```bash
# Check disk space
df -h

# Check memory usage
free -h

# Check CPU usage
top

# Check running processes
ps aux | grep node

# Check open ports
sudo ss -tlnp

# Check system logs
sudo journalctl -xe

# Check Node version
node --version

# Check npm version
npm --version

# Check PM2 version
pm2 --version

# Check Nginx version
nginx -v
```

### Node/NPM Commands

```bash
# Install dependencies
npm install

# Build application
npm run build

# Run development server
npm run dev

# Run tests
npm test
npm run test:server

# Type check
npm run check

# Lint code
npm run lint

# Format code
npm run format
```

### Debugging Commands

```bash
# Test API health endpoint
curl http://localhost:3000/health
curl http://136.118.23.174/health

# Test with verbose output
curl -v http://localhost:3000/health

# Check response headers
curl -I http://localhost:3000/health

# Test POST request
curl -X POST http://localhost:3000/api/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"password123"}'

# Monitor network connections
sudo ss -tnp | grep :3000

# Watch logs in real-time
tail -f ~/.pm2/logs/wordgame-api-out.log

# Search logs for errors
grep -i error ~/.pm2/logs/wordgame-api-error.log

# Check environment variables
printenv | grep DATABASE
```

---

## Quick Reference Card

### First-Time Deployment

```bash
# 1. Local: Deploy code
./scripts/deploy.sh

# 2. Local: SSH to VM
./scripts/ssh.sh

# 3. VM: Setup application
cd wordgame && ./scripts/setup-vm.sh

# 4. VM: Setup Nginx
./scripts/setup-nginx.sh

# 5. VM: Create .env file
nano .env  # Add DATABASE_URL, etc.

# 6. Local: Push database schema
npm run db:push

# 7. VM: Verify
pm2 logs wordgame-api
curl http://localhost
```

### Regular Updates

```bash
# 1. Local: Deploy updated code
./scripts/deploy.sh

# 2. Local: SSH to VM
./scripts/ssh.sh

# 3. VM: Rebuild and restart
cd wordgame
npm install  # If package.json changed
npm run build
pm2 restart wordgame-api
pm2 logs wordgame-api
```

### Emergency Fixes

```bash
# App crashed
pm2 restart wordgame-api
pm2 logs wordgame-api --lines 100

# Port stuck
./scripts/cleanup-port.sh

# Nginx issues
sudo nginx -t
sudo systemctl restart nginx

# Database issues
# Run from local with Cloud SQL Proxy
npm run db:push

# Complete reset
pm2 delete all
pkill -9 node
cd ~/wordgame
npm run build
pm2 start npm --name wordgame-api -- start
pm2 save
```

---

## Environment Variables Summary

### Required on VM

- `DATABASE_URL` - PostgreSQL connection string with Unix socket
- `NODE_ENV` - Set to `production`
- `PORT` - API port (default: 3000)
- `JWT_SECRET` - Secret for JWT tokens

### Required Locally

- `GCP_PROJECT_ID` - GCP project ID
- `GCP_VM_NAME` - VM instance name
- `GCP_ZONE` - VM zone
- `DATABASE_URL` - PostgreSQL connection via Cloud SQL Proxy
- `NODE_ENV` - Set to `development`
- `PORT` - API port (default: 3000)
- `JWT_SECRET` - Secret for JWT tokens

---

## File Structure on VM

```
/home/USERNAME/
└── wordgame/
    ├── server/           # Server source code
    ├── client/           # Client source code
    ├── lib/              # Shared library code
    ├── scripts/          # Deployment scripts
    ├── dist/             # Built application
    │   └── start.js      # Production entry point
    ├── node_modules/     # Dependencies
    ├── package.json      # NPM dependencies
    ├── package-lock.json
    ├── tsconfig.json     # TypeScript config
    ├── drizzle.config.ts # Drizzle ORM config
    ├── .env              # Environment variables (not in git)
    └── ecosystem.config.js # PM2 config (optional)
```

---

## Security Checklist

- [ ] `.env` file is not committed to git
- [ ] JWT_SECRET is a strong random string
- [ ] Database password is strong
- [ ] Firewall rules are restrictive (only necessary ports)
- [ ] HTTPS is enabled with valid SSL certificate
- [ ] Nginx security headers are enabled
- [ ] PM2 is configured to restart on crashes
- [ ] System packages are up to date (`sudo apt-get update && sudo apt-get upgrade`)
- [ ] Database backups are configured
- [ ] Monitoring/alerting is set up

---

## Additional Resources

- [GCP Compute Engine Docs](https://cloud.google.com/compute/docs)
- [GCP Cloud SQL Docs](https://cloud.google.com/sql/docs)
- [PM2 Documentation](https://pm2.keymetrics.io/docs/)
- [Nginx Documentation](https://nginx.org/en/docs/)
- [Drizzle ORM Documentation](https://orm.drizzle.team/)
- [Let's Encrypt Certbot](https://certbot.eff.org/)
